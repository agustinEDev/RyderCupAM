# Github exaple 3: Conditionals (simplified)
# This demonstrates basic conditional logic in GitHub Actions

name: 03 - Simple Conditionals

on:
  push:
  pull_request:
  workflow_dispatch:

    inputs:
      run-tests:
        description: 'Run tests?'
        required: false
        default: 'true'
        type: boolean

jobs:
  # Job 1: Always runs basic checks
  setup:
    runs-on: ubuntu-latest
    outputs:
      is_main: ${{ steps.check_branch.outputs.is_main }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check if main branch
        id: check_branch
        run: |
          if [ "${{ github.ref }}" == "refs/heads/main" ]; then
            echo "is_main=true" >> $GITHUB_OUTPUT
            echo "This is the main branch âœ…"
          else
            echo "is_main=false" >> $GITHUB_OUTPUT
            echo "This is NOT the main branch âŒ"
          fi

  # Job 2: Run tests conditionally
  test:
    runs-on: ubuntu-latest
    needs: setup
    # Only run if tests are enabled (default: true)
    if: ${{ inputs.run-tests != false }}

    steps:
      - name: Run Tests
        run: |
          sleep 2
          echo "Tests completed! âœ…"

      # This step only runs in main branch
      - name: Run extra tests on main
        if: ${{ needs.setup.outputs.is_main == 'true' }}
        run: |
          echo "Running additional tests for main branch..."
          echo "Extra tests completed! âœ…"

  # Job 3: Build (always runs if setup succeeds)
  build:
    runs-on: ubuntu-latest
    needs: [setup, test]
    # Run if tests passed OR tests were skipped
    if: ${{always() && needs.setup.result == 'success' && (needs.test.result == 'success' || needs.test.result == 'skipped') }}

    steps:
      - name: Build Application
        run: |
          echo "Building application..."
          sleep 3
          echo "Build completed! ğŸ—ï¸"

  # Job 4: Cleanup (always runs)
  cleanup:
    runs-on: ubuntu-latest
    needs: [setup, test, build]
    if: always()

    steps:
      - name: cleanup
        run: |
          echo "Cleaning up..."
          echo "Setup: ${{ needs.setup.result }}"
          echo "Test: ${{ needs.test.result }}"
          echo "Build: ${{ needs.build.result }}"
          echo "Cleanup completed! ğŸ§¹"