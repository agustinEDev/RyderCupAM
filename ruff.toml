# ================================
# CONFIGURACIÓN DE RUFF
# ================================
# Ruff es un linter ultra-rápido para Python que reemplaza múltiples herramientas:
# - flake8 (linting general)
# - isort (ordenar imports)
# - pydocstyle (documentación)
# - pyupgrade (modernizar sintaxis)
# - autoflake (remover imports sin usar)

# Versión mínima de Python que soporta el proyecto
target-version = "py312"

# Longitud máxima de línea (PEP 8 recomienda 79, pero 100 es más práctico)
line-length = 100

# Directorios a excluir del análisis
exclude = [
    ".git",
    ".venv",
    "venv",
    "__pycache__",
    "*.egg-info",
    ".pytest_cache",
    ".mypy_cache",
    "alembic/versions",  # Migraciones auto-generadas
    "build",
    "dist",
]

[lint]
# Reglas activadas (códigos de ruff)
# Ver: https://docs.astral.sh/ruff/rules/
select = [
    "E",      # pycodestyle errors
    "W",      # pycodestyle warnings
    "F",      # pyflakes
    "I",      # isort (ordenar imports)
    "N",      # pep8-naming
    "UP",     # pyupgrade (modernizar sintaxis)
    "B",      # flake8-bugbear (errores comunes)
    "C4",     # flake8-comprehensions
    "SIM",    # flake8-simplify
    "RET",    # flake8-return
    "ARG",    # flake8-unused-arguments
    "PTH",    # flake8-use-pathlib
    "ERA",    # eradicate (código comentado)
    "PL",     # pylint
    "RUF",    # ruff-specific rules
]

# Reglas ignoradas (desactivadas)
ignore = [
    "E501",   # line-too-long (ya lo controlamos con line-length)
    "B008",   # do-not-perform-function-calls-in-argument-defaults (común en FastAPI)
    "PLR0913", # too-many-arguments (común en casos de uso)
    "ARG002", # unused-method-argument (común en interfaces/protocolos)
    "RET504", # unnecessary-assign (a veces mejora la legibilidad)
]

# Permitir autofix para estas reglas al ejecutar `ruff check --fix`
fixable = ["ALL"]
unfixable = []

[lint.per-file-ignores]
# Tests pueden tener imports sin usar, funciones largas, etc.
"tests/**/*.py" = [
    "ARG",      # unused arguments (fixtures)
    "PLR2004",  # magic-value-comparison
    "S101",     # use of assert
    "PLC0415",  # import-outside-toplevel (lazy imports in fixtures)
    "E721",     # type-comparison (comparing types in tests)
    "PTH123",   # open-builtin (Path.open not always needed in tests)
    "B017",     # assert-raises-exception (pytest.raises patterns)
    "RUF043",   # implicit-raw-string (regex patterns in pytest.raises)
    "SIM105",   # suppressible-exception (contextlib.suppress usage)
    "UP035",    # deprecated-import (typing.AsyncContextManager in tests)
    "SIM102",   # collapsible-if (nested ifs can be clearer in tests)
    "RUF003",   # ambiguous-unicode-character (intentional in homograph tests)
    "PLC0206",  # dict-index-missing-items (intentional in error tests)
    "N806",     # non-lowercase-variable-in-function (test data naming)
    "ERA001",   # commented-out-code (example code in docstrings)
    "E402",     # module-level-import-not-at-top-of-file (setup imports)
]

# Archivos de configuración pueden tener imports no ordenados
"alembic/env.py" = ["I", "ERA001"]

# dev_tests.py puede tener errores de linting (es un script utilitario)
"dev_tests.py" = ["PTH123", "SIM102", "PLR2004"]

# K8s scripts pueden tener imports después de sys.path setup
"k8s/scripts/*.py" = ["E402", "PLR2004"]

# Domain entities pueden tener imports locales para evitar circular imports
"src/modules/golf_course/domain/entities/*.py" = ["PLC0415"]
"src/modules/golf_course/infrastructure/api/v1/golf_course_routes.py" = ["PLC0415"]

[lint.isort]
# Configuración de ordenamiento de imports (compatible con Black)
combine-as-imports = true
force-wrap-aliases = true
known-first-party = ["src"]

[lint.pydocstyle]
# Estilo de docstrings (Google style)
convention = "google"
