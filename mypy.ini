# ================================
# CONFIGURACIÓN DE MYPY
# ================================
# Mypy es un verificador estático de tipos para Python.
# Analiza el código usando type hints para detectar errores antes de runtime.

[mypy]
# Versión de Python
python_version = 3.12

# Directorios a analizar
files = src/

# Directorios a excluir
exclude = (
    ^alembic/versions/.*\.py$|  # Migraciones auto-generadas
    ^tests/.*\.py$|              # Tests (opcional excluirlos)
    ^\.venv/.*\.py$              # Virtual environment
)

# ================================
# CONFIGURACIÓN GENERAL
# ================================

# Modo estricto (activa muchas validaciones)
# warn_return_any = True
# warn_unused_configs = True
disallow_untyped_defs = False  # Permite funciones sin type hints (gradual typing)
disallow_any_unimported = False
disallow_any_expr = False
disallow_any_decorated = False
disallow_any_explicit = False
disallow_any_generics = False
disallow_subclassing_any = False

# Advertencias
warn_redundant_casts = True
warn_unused_ignores = True
warn_no_return = True
warn_unreachable = True

# Imports
ignore_missing_imports = True  # Ignorar librerías sin type stubs
follow_imports = normal

# Cache y reportes
incremental = True
cache_dir = .mypy_cache
show_error_codes = True
show_column_numbers = True
pretty = True

# ================================
# CONFIGURACIÓN POR MÓDULO
# ================================

# FastAPI - muchos decoradores y dependencias dinámicas
[mypy-src.modules.*.infrastructure.api.*]
disallow_untyped_defs = False
disable_error_code = arg-type, var-annotated

# SQLAlchemy - ORM con mucha magia
[mypy-src.modules.*.infrastructure.persistence.*]
disallow_untyped_defs = False
disable_error_code = assignment, attr-defined

# Alembic - migraciones con imports dinámicos
[mypy-alembic.*]
ignore_errors = True

# Tests - permitir más flexibilidad
[mypy-tests.*]
disallow_untyped_defs = False
disable_error_code = arg-type, no-untyped-call

# ================================
# THIRD-PARTY LIBRARIES SIN STUBS
# ================================

[mypy-passlib.*]
ignore_missing_imports = True

[mypy-jose.*]
ignore_missing_imports = True

[mypy-bcrypt.*]
ignore_missing_imports = True

[mypy-asyncpg.*]
ignore_missing_imports = True
