# ================================
# CONFIGURACIÓN DE MYPY
# ================================
# Mypy es un verificador estático de tipos para Python.
# Analiza el código usando type hints para detectar errores antes de runtime.

[mypy]
# Versión de Python
python_version = 3.12

# Directorios a analizar
files = src/

# Directorios a excluir (regex pattern)
exclude = ^(alembic/versions/|tests/|\.venv/)

# ================================
# CONFIGURACIÓN GENERAL
# ================================

# Modo estricto (activa muchas validaciones)
# warn_return_any = True
# warn_unused_configs = True

# Permite funciones sin type hints (gradual typing)
disallow_untyped_defs = False
disallow_any_unimported = False
disallow_any_expr = False
disallow_any_decorated = False
disallow_any_explicit = False
disallow_any_generics = False
disallow_subclassing_any = False

# Advertencias
warn_redundant_casts = True
warn_unused_ignores = True
warn_no_return = True
warn_unreachable = True

# Imports - Ignorar librerías sin type stubs
ignore_missing_imports = True
follow_imports = normal

# Cache y reportes
incremental = True
cache_dir = .mypy_cache
show_error_codes = True
show_column_numbers = True
pretty = True

# ================================
# CONFIGURACIÓN POR MÓDULO
# ================================

# Application layer - Use cases with business logic
[mypy-src.modules.*.application.*]
disallow_untyped_defs = False
disable_error_code = union-attr, attr-defined, arg-type, call-arg

# FastAPI - muchos decoradores y dependencias dinámicas
[mypy-src.modules.*.infrastructure.api.*]
disallow_untyped_defs = False
disable_error_code = arg-type, var-annotated, union-attr, attr-defined, call-arg

# SQLAlchemy - ORM con mucha magia (imperative mapping)
[mypy-src.modules.*.infrastructure.persistence.*]
disallow_untyped_defs = False
disable_error_code = assignment, attr-defined, var-annotated, no-any-return, misc, override, arg-type, index, unreachable

# Domain entities - SQLAlchemy imperative mapping adds dynamic attributes
[mypy-src.modules.*.domain.entities.*]
disallow_untyped_defs = False
disable_error_code = attr-defined, var-annotated, misc, no-redef, union-attr, assignment

# Domain events - may have dynamic attributes
[mypy-src.modules.*.domain.events.*]
disallow_untyped_defs = False
disable_error_code = attr-defined, misc, union-attr, no-redef

# Config/Settings - may have Optional[str] assignments
[mypy-src.config.*]
disallow_untyped_defs = False
disable_error_code = assignment, attr-defined

[mypy-src.shared.infrastructure.email.*]
disallow_untyped_defs = False
disable_error_code = assignment, attr-defined, arg-type

# Logging infrastructure - complex dynamic configuration
[mypy-src.shared.infrastructure.logging.*]
disallow_untyped_defs = False
disable_error_code = assignment, var-annotated, union-attr, attr-defined

[mypy-src.shared.infrastructure.persistence.*]
disallow_untyped_defs = False
disable_error_code = assignment, attr-defined, var-annotated, override, arg-type

# Shared domain - Event bus and events
[mypy-src.shared.domain.*]
disallow_untyped_defs = False
disable_error_code = attr-defined, var-annotated

# Alembic - migraciones con imports dinámicos
[mypy-alembic.*]
ignore_errors = True

# Tests - permitir más flexibilidad
[mypy-tests.*]
disallow_untyped_defs = False
disable_error_code = arg-type, no-untyped-call

# ================================
# THIRD-PARTY LIBRARIES SIN STUBS
# ================================

[mypy-passlib.*]
ignore_missing_imports = True

[mypy-jose.*]
ignore_missing_imports = True

[mypy-bcrypt.*]
ignore_missing_imports = True

[mypy-asyncpg.*]
ignore_missing_imports = True

[mypy-requests.*]
ignore_missing_imports = True

[mypy-yaml.*]
ignore_missing_imports = True

[mypy-uvicorn.*]
ignore_missing_imports = True

[mypy-mailgun.*]
ignore_missing_imports = True
